name: "Download CPEs"
on: 
  workflow_dispatch:
    inputs:
      start-date:
        description: "Start date for downloading CPEs"
        type: string
        required: true
        default: "2021-01-01"
      end-date:
        description: "End date for downloading CPEs"
        type: string
        required: true
        default: "2021-12-31"

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        apt-get install git-lfs
        git lfs install
    - name: Run cve2stix to download CPEs
      run: |
        touch credentials.yml
        echo "$NVD_API_KEY" > credentials.yml
        python scripts/download-cpes.py "${{ github.event.inputs.start-date }}" "${{ github.event.inputs.end-date }}"
      env:
        NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
    - name: Push commits to repo
      run: |
        git push origin
